{% extends 'base.html' %}
{% load custom_filters %}

{% block title %}{{ page_title }}{% endblock %}

{% block extra_css %}
<style>
.back-to-orders-btn {
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.5rem 1rem;
    background-color: #f3f0ff;
    color: #6a4ec1;
    border-radius: 0.5rem;
    font-weight: 500;
    font-size: 0.9375rem;
    transition: all 0.2s;
    margin-bottom: 1rem;
}
.back-to-orders-btn:hover {
    background-color: #e5e0ff;
}
.back-to-orders-btn svg {
    flex-shrink: 0;
}
</style>
{% endblock %}

{% block content %}
<div class="container mx-auto px-4 py-8">
    <!-- Header -->
    <div class="mb-6">
        <a href="{% url 'order_tracking' %}" class="back-to-orders-btn">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"/>
            </svg>
            <span>Quay l·∫°i tra c·ª©u ƒë∆°n h√†ng</span>
        </a>
        <h1 class="text-3xl font-bold text-gray-800">Chi ti·∫øt ƒë∆°n h√†ng #{{ order.id }}</h1>
    </div>

    <div class="flex flex-col lg:flex-row gap-8">
        <!-- Th√¥ng tin ƒë∆°n h√†ng -->
        <div class="lg:w-2/3 space-y-6">
            <!-- Tr·∫°ng th√°i ƒë∆°n h√†ng -->
            <div class="bg-white rounded-xl shadow-md p-6">
                <h2 class="text-xl font-semibold mb-4 flex items-center gap-2">üìä Tr·∫°ng th√°i ƒë∆°n h√†ng</h2>
                
                <div class="flex flex-wrap items-center gap-4 mb-4">
                    {% if order.status == 'pending' %}
                        <span class="px-4 py-2 bg-yellow-100 text-yellow-800 rounded-lg font-medium">
                            ‚è≥ Ch·ªù duy·ªát
                        </span>
                    {% elif order.status == 'approved' %}
                        <span class="px-4 py-2 bg-blue-100 text-blue-800 rounded-lg font-medium">
                            ‚úÖ ƒê√£ duy·ªát
                        </span>
                    {% elif order.status == 'processing' %}
                        <span class="px-4 py-2 bg-purple-100 text-purple-800 rounded-lg font-medium">
                            üì¶ Ti·∫øp nh·∫≠n
                        </span>
                    {% elif order.status == 'completed' %}
                        <span class="px-4 py-2 bg-green-100 text-green-800 rounded-lg font-medium">
                            üéâ Th√†nh c√¥ng
                        </span>
                    {% elif order.status == 'cancelled' %}
                        <span class="px-4 py-2 bg-red-100 text-red-800 rounded-lg font-medium">
                            ‚ùå ƒê√£ h·ªßy
                        </span>
                    {% endif %}
                    
                    <span class="text-gray-500">
                        ƒê·∫∑t ng√†y {{ order.created_at|date:"d/m/Y H:i" }}
                    </span>
                </div>
                
                <!-- Timeline tr·∫°ng th√°i -->
                <div class="border-t pt-4">
                    <div class="flex items-center justify-between text-sm">
                        <div class="flex flex-col items-center {% if order.status != 'cancelled' %}text-green-600{% else %}text-gray-400{% endif %}">
                            <div class="w-8 h-8 rounded-full bg-green-100 flex items-center justify-center mb-1">‚úì</div>
                            <span>ƒê·∫∑t h√†ng</span>
                        </div>
                        <div class="flex-1 h-1 bg-gray-200 mx-2">
                            <div class="h-full bg-green-500" style="width: {% if order.status == 'pending' %}0{% else %}100{% endif %}%"></div>
                        </div>
                        <div class="flex flex-col items-center {% if order.status in 'approved,processing,completed' %}text-green-600{% elif order.status == 'pending' %}text-gray-400{% else %}text-gray-400{% endif %}">
                            <div class="w-8 h-8 rounded-full {% if order.status in 'approved,processing,completed' %}bg-green-100{% else %}bg-gray-100{% endif %} flex items-center justify-center mb-1">
                                {% if order.status in 'approved,processing,completed' %}‚úì{% else %}2{% endif %}
                            </div>
                            <span>Duy·ªát</span>
                        </div>
                        <div class="flex-1 h-1 bg-gray-200 mx-2">
                            <div class="h-full bg-green-500" style="width: {% if order.status in 'processing,completed' %}100{% else %}0{% endif %}%"></div>
                        </div>
                        <div class="flex flex-col items-center {% if order.status in 'processing,completed' %}text-green-600{% else %}text-gray-400{% endif %}">
                            <div class="w-8 h-8 rounded-full {% if order.status in 'processing,completed' %}bg-green-100{% else %}bg-gray-100{% endif %} flex items-center justify-center mb-1">
                                {% if order.status in 'processing,completed' %}‚úì{% else %}3{% endif %}
                            </div>
                            <span>Ti·∫øp nh·∫≠n</span>
                        </div>
                        <div class="flex-1 h-1 bg-gray-200 mx-2">
                            <div class="h-full bg-green-500" style="width: {% if order.status == 'completed' %}100{% else %}0{% endif %}%"></div>
                        </div>
                        <div class="flex flex-col items-center {% if order.status == 'completed' %}text-green-600{% else %}text-gray-400{% endif %}">
                            <div class="w-8 h-8 rounded-full {% if order.status == 'completed' %}bg-green-100{% else %}bg-gray-100{% endif %} flex items-center justify-center mb-1">
                                {% if order.status == 'completed' %}‚úì{% else %}4{% endif %}
                            </div>
                            <span>Ho√†n th√†nh</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Th√¥ng tin giao h√†ng -->
            <div class="bg-white rounded-xl shadow-md p-6">
                <h2 class="text-xl font-semibold mb-4 flex items-center gap-2">üìç Th√¥ng tin giao h√†ng</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm">
                    <div>
                        <p class="text-gray-500">H·ªç v√† t√™n ng∆∞·ªùi nh·∫≠n</p>
                        <p class="font-medium">{{ order.full_name }}</p>
                    </div>
                    <div>
                        <p class="text-gray-500">S·ªë ƒëi·ªán tho·∫°i</p>
                        <p class="font-medium">{{ order.phone }}</p>
                    </div>
                    <div class="md:col-span-2">
                        <p class="text-gray-500">ƒê·ªãa ch·ªâ giao h√†ng</p>
                        <p class="font-medium">{{ order.address }}</p>
                    </div>
                    {% if order.note %}
                    <div class="md:col-span-2">
                        <p class="text-gray-500">Ghi ch√∫</p>
                        <p class="font-medium">{{ order.note }}</p>
                    </div>
                    {% endif %}
                </div>
            </div>

            <!-- S·∫£n ph·∫©m trong ƒë∆°n -->
            <div class="bg-white rounded-xl shadow-md p-6">
                <h2 class="text-xl font-semibold mb-4 flex items-center gap-2">üì¶ S·∫£n ph·∫©m ƒë√£ ƒë·∫∑t</h2>
                <div class="space-y-4">
                    {% for item in order_items %}
                    <div class="flex gap-4 border-b pb-4 last:border-0 last:pb-0">
                        <div class="w-20 h-20 bg-gray-100 rounded-lg flex items-center justify-center">
                            {% if item.product %}
                                {% with product=item.product %}
                                {% if product.main_image %}
                                    <img src="{{ product.main_image.url }}" alt="{{ product.name }}" class="w-full h-full object-cover rounded-lg">
                                {% else %}
                                    <span class="text-3xl">üì±</span>
                                {% endif %}
                                {% endwith %}
                            {% else %}
                                <span class="text-3xl">üì±</span>
                            {% endif %}
                        </div>
                        <div class="flex-1">
                            <h3 class="font-semibold">{{ item.product.name|default:"S·∫£n ph·∫©m" }}</h3>
                            <p class="text-sm text-gray-500">
                                {% if item.storage %}{{ item.storage }}{% endif %}
                                {% if item.color %}/ {{ item.color }}{% endif %}
                            </p>
                            <p class="text-sm">S·ªë l∆∞·ª£ng: {{ item.quantity }}</p>
                        </div>
                        <div class="text-right">
                            <p class="font-semibold text-red-500">{{ item.subtotal|format_vnd }}ƒë</p>
                            {% if item.price < item.subtotal %}
                                <p class="text-sm text-gray-400 line-through">{{ item.price|format_vnd }}ƒë</p>
                            {% endif %}
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>
        </div>

        <!-- T·ªïng ti·ªÅn -->
        <div class="lg:w-1/3">
            <div class="bg-white rounded-xl shadow-md p-6 sticky top-24">
                <h2 class="text-xl font-semibold mb-4">üí∞ T√≥m t·∫Øt thanh to√°n</h2>
                
                <div class="space-y-3 text-sm">
                    <div class="flex justify-between">
                        <span class="text-gray-500">T·ªïng ti·ªÅn h√†ng</span>
                        <span class="font-medium">{{ order.subtotal|format_vnd }}ƒë</span>
                    </div>
                    
                    {% if order.discount_amount > 0 %}
                    <div class="flex justify-between text-green-600">
                        <span>Gi·∫£m gi√° {% if order.coupon_code %}({{ order.coupon_code }}){% endif %}</span>
                        <span>-{{ order.discount_amount|format_vnd }}ƒë</span>
                    </div>
                    {% endif %}
                    
                    <div class="border-t pt-3 flex justify-between text-lg font-semibold">
                        <span>T·ªïng thanh to√°n</span>
                        <span class="text-red-500">{{ order.total|format_vnd }}ƒë</span>
                    </div>
                </div>
                
                <div class="mt-6 pt-4 border-t">
                    <p class="text-sm text-gray-500 mb-2">Ph∆∞∆°ng th·ª©c thanh to√°n</p>
                    {% if order.payment_method == 'cod' %}
                        <div class="flex items-center gap-2 text-green-600 font-medium">
                            <span>üíµ</span>
                            <span>Thanh to√°n khi nh·∫≠n h√†ng (COD)</span>
                        </div>
                    {% else %}
                        <div class="flex items-center gap-2 text-blue-600 font-medium">
                            <span>üí≥</span>
                            <span>Thanh to√°n online</span>
                        </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

