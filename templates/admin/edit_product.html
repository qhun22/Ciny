{% extends 'base.html' %}

{% block title %}{{ page_title }}{% endblock %}

{% block content %}
<div class="container mx-auto px-4 py-8">
    <div class="max-w-4xl mx-auto">
        <!-- Tieu de -->
        <div class="mb-8">
            <h1 class="text-3xl font-bold text-gray-800">
                {% if is_edit %}Chinh sua san pham{% else %}Them san pham moi{% endif %}
            </h1>
            <p class="text-gray-500 mt-2">
                {% if is_edit %}Cap nhat thong tin san pham{% else %}Dien thong tin san pham vao form ben duoi{% endif %}
            </p>
        </div>

        <!-- Form san pham -->
        <form method="POST" enctype="multipart/form-data" class="space-y-8">
            {% csrf_token %}

            <!-- Thong tin co ban -->
            <div class="bg-white rounded-xl shadow-md p-6">
                <h2 class="text-xl font-semibold mb-4">üì± Thong tin co ban</h2>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <!-- Hang san xuat -->
                    <div>
                        <label class="block text-gray-700 mb-2">Hang san xuat *</label>
                        <input type="text" name="brand" 
                               value="{{ product.brand|default:'' }}" required
                               placeholder="Vi du: Apple, Samsung, Xiaomi"
                               class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:outline-none focus:border-primary">
                    </div>
                    
                    <!-- Ten san pham -->
                    <div>
                        <label class="block text-gray-700 mb-2">Ten san pham *</label>
                        <input type="text" name="name" 
                               value="{{ product.name|default:'' }}" required
                               placeholder="Vi du: iPhone 15 Pro Max"
                               class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:outline-none focus:border-primary">
                    </div>
                </div>
                
                <!-- Anh chinh -->
                <div class="mt-4">
                    <label class="block text-gray-700 mb-2">Anh chinh {% if not is_edit %}*{% endif %}</label>
                    {% if is_edit and product.main_image %}
                    <div class="mb-2">
                        <img src="{{ product.main_image.url }}" alt="Anh hien tai" class="w-32 h-32 object-cover rounded-lg">
                        <p class="text-sm text-gray-500 mt-1">Anh hien tai</p>
                    </div>
                    {% endif %}
                    <input type="file" name="main_image" accept="image/*" {% if not is_edit %}required{% endif %}
                           class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:outline-none focus:border-primary">
                    {% if is_edit %}
                    <p class="text-sm text-gray-500 mt-1">Bo trong de giu anh hien tai</p>
                    {% else %}
                    <p class="text-sm text-gray-500 mt-1">Anh nay se hien thi trong danh sach san pham</p>
                    {% endif %}
                </div>
            </div>

            <!-- Gia ca -->
            <div class="bg-white rounded-xl shadow-md p-6">
                <h2 class="text-xl font-semibold mb-4">üí∞ Thong tin gia ca</h2>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <!-- Gia goc -->
                    <div>
                        <label class="block text-gray-700 mb-2">Gia goc (VND) *</label>
                        <input type="number" name="original_price" min="0" 
                               value="{{ product.original_price|default:'' }}" required
                               placeholder="Vi du: 30000000"
                               class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:outline-none focus:border-primary">
                    </div>
                    
                    <!-- Phan tram giam gia -->
                    <div>
                        <label class="block text-gray-700 mb-2">Phan tram giam gia (%) *</label>
                        <input type="number" name="discount_percent" min="0" max="100" step="0.1"
                               value="{{ product.discount_percent|default:0 }}" required
                               placeholder="Vi du: 13.8"
                               class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:outline-none focus:border-primary">
                        <p class="text-sm text-gray-500 mt-1">Gia se duoc tinh tu dong (VD: 13.8)</p>
                    </div>
                </div>
            </div>

            <!-- Thong tin bao hanh va dac diem -->
            <div class="bg-white rounded-xl shadow-md p-6">
                <h2 class="text-xl font-semibold mb-4">üõ°Ô∏è Bao hanh va dac diem</h2>
                
                <!-- Thoi gian bao hanh -->
                <div class="mb-4">
                    <label class="block text-gray-700 mb-2">Thoi gian bao hanh (thang)</label>
                    <input type="number" name="warranty_months" min="0" 
                           value="{{ product.warranty_months|default:12 }}"
                           class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:outline-none focus:border-primary">
                </div>
                
                <!-- Checkboxes -->
                <div class="flex flex-wrap gap-4">
                    <label class="flex items-center cursor-pointer">
                        <input type="checkbox" name="free_shipping" 
                               {% if product.free_shipping %}checked{% endif %}
                               class="w-5 h-5 text-primary border-gray-300 rounded focus:ring-primary">
                        <span class="ml-2">Mien phi giao hang</span>
                    </label>
                    
                    <label class="flex items-center cursor-pointer">
                        <input type="checkbox" name="open_box_check"
                               {% if product.open_box_check %}checked{% endif %}
                               class="w-5 h-5 text-primary border-gray-300 rounded focus:ring-primary">
                        <span class="ml-2">Mo hop kiem tra</span>
                    </label>
                    
                    <label class="flex items-center cursor-pointer">
                        <input type="checkbox" name="return_30_days"
                               {% if product.return_30_days %}checked{% endif %}
                               class="w-5 h-5 text-primary border-gray-300 rounded focus:ring-primary">
                        <span class="ml-2">Doi tra trong 30 ngay</span>
                    </label>
                </div>
                
                <!-- YouTube ID -->
                <div class="mt-4">
                    <label class="block text-gray-700 mb-2">ID Video YouTube</label>
                    <input type="text" name="youtube_id" 
                           value="{{ product.youtube_id|default:'' }}"
                           placeholder="Vi du: dQw4w9WgXcQ (lay phan cuoi cua URL)"
                           class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:outline-none focus:border-primary">
                    <p class="text-sm text-gray-500 mt-1">Nhap ID video de hien thi video review trong trang chi tiet</p>
                </div>
            </div>

            <!-- Mo ta va thong so ky thuat -->
            <div class="bg-white rounded-xl shadow-md p-6">
                <h2 class="text-xl font-semibold mb-4">üìù Mo ta va thong so ky thuat</h2>
                
                <!-- Mo ta san pham -->
                <div class="mb-4">
                    <label class="block text-gray-700 mb-2">Mo ta san pham *</label>
                    <textarea name="description" rows="5" required
                              placeholder="Nhap mo ta chi tiet ve san pham..."
                              class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:outline-none focus:border-primary">{{ product.description|default:'' }}</textarea>
                </div>
                
                <!-- Thong so ky thuat -->
                <div>
                    <label class="block text-gray-700 mb-2">Thong so ky thuat *</label>
                    <textarea name="specifications" rows="5" required
                              placeholder="Nhap thong so ky thuat..."
                              class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:outline-none focus:border-primary">{{ product.specifications|default:'' }}</textarea>
                </div>
            </div>

            <!-- Hinh anh chi tiet -->
            <div class="bg-white rounded-xl shadow-md p-6">
                <h2 class="text-xl font-semibold mb-4">üñºÔ∏è Hinh anh chi tiet</h2>
                
                {% if is_edit and product.images.exists %}
                <div class="mb-4 flex flex-wrap gap-2">
                    {% for img in product.images.all %}
                    <div class="relative">
                        <img src="{{ img.image.url }}" alt="Anh {{ forloop.counter }}" class="w-20 h-20 object-cover rounded-lg">
                    </div>
                    {% endfor %}
                </div>
                {% endif %}
                
                <label class="block text-gray-700 mb-2">Chon them anh chi tiet</label>
                <input type="file" name="detail_images" accept="image/*" multiple
                       class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:outline-none focus:border-primary">
                <p class="text-sm text-gray-500 mt-1">Co the chon nhieu anh cung luc</p>
            </div>

            <!-- Tuy chon bo nho -->
            <div class="bg-white rounded-xl shadow-md p-6">
                <h2 class="text-xl font-semibold mb-4">üíæ Tuy chon bo nho</h2>
                <p class="text-gray-500 mb-4">Them cac phien ban bo nho khac nhau</p>
                
                <div id="storageContainer" class="space-y-3">
                    {% if is_edit and product.storage_options.exists %}
                    {% for storage in product.storage_options.all %}
                    <div class="flex gap-3 storage-row">
                        <input type="text" name="storage_name[]" value="{{ storage.storage }}" placeholder="Vi du: 256GB"
                               class="flex-1 border border-gray-300 rounded-lg px-4 py-2 focus:outline-none focus:border-primary">
                        <input type="number" name="storage_price[]" value="{{ storage.original_price }}" placeholder="Gia goc (VND)"
                               min="0"
                               class="w-48 border border-gray-300 rounded-lg px-4 py-2 focus:outline-none focus:border-primary">
                        <button type="button" onclick="removeRow(this)"
                                class="bg-red-500 text-white px-4 py-2 rounded-lg hover:bg-red-600 transition">
                            -
                        </button>
                    </div>
                        {% endfor %}
                    {% else %}
                    <div class="flex gap-3 storage-row">
                        <input type="text" name="storage_name[]" placeholder="Vi du: 128GB"
                               class="flex-1 border border-gray-300 rounded-lg px-4 py-2 focus:outline-none focus:border-primary">
                        <input type="number" name="storage_price[]" placeholder="Gia goc (VND)"
                               min="0" value="0"
                               class="w-48 border border-gray-300 rounded-lg px-4 py-2 focus:outline-none focus:border-primary">
                        <button type="button" onclick="addStorageRow()"
                                class="bg-green-500 text-white px-4 py-2 rounded-lg hover:bg-green-600 transition">
                            +
                        </button>
                    </div>
                    {% endif %}
                </div>
                
                <button type="button" onclick="addStorageRow()"
                        class="mt-4 text-primary hover:underline">
                    + Them tuy chon bo nho
                </button>
            </div>

            <!-- Tuy chon mau sac -->
            <div class="bg-white rounded-xl shadow-md p-6">
                <h2 class="text-xl font-semibold mb-4">üé® Tuy chon mau sac</h2>
                <p class="text-gray-500 mb-4">Them cac mau sac co san cho san pham</p>
                
                <div id="colorContainer" class="space-y-3">
                    {% if is_edit and product.color_options.exists %}
                    {% for color in product.color_options.all %}
                    <div class="flex gap-3 color-row">
                        <input type="text" name="color_name[]" value="{{ color.color_name }}" placeholder="Vi du: Midnight Black"
                               class="flex-1 border border-gray-300 rounded-lg px-4 py-2 focus:outline-none focus:border-primary">
                            <div class="flex-1 flex items-center gap-2">
                                {% if color.color_image %}
                                <img src="{{ color.color_image.url }}" alt="{{ color.color_name }}" class="w-10 h-10 object-cover rounded-lg">
                                {% endif %}
                        <input type="file" name="color_image[]" accept="image/*"
                               class="flex-1 border border-gray-300 rounded-lg px-4 py-2 focus:outline-none focus:border-primary">
                            </div>
                        <button type="button" onclick="removeRow(this)"
                                class="bg-red-500 text-white px-4 py-2 rounded-lg hover:bg-red-600 transition">
                            -
                        </button>
                    </div>
                        {% endfor %}
                    {% else %}
                    <div class="flex gap-3 color-row">
                        <input type="text" name="color_name[]" placeholder="Vi du: Midnight Black"
                               class="flex-1 border border-gray-300 rounded-lg px-4 py-2 focus:outline-none focus:border-primary">
                        <input type="file" name="color_image[]" accept="image/*"
                               class="flex-1 border border-gray-300 rounded-lg px-4 py-2 focus:outline-none focus:border-primary">
                        <button type="button" onclick="addColorRow()"
                                class="bg-green-500 text-white px-4 py-2 rounded-lg hover:bg-green-600 transition">
                            +
                        </button>
                    </div>
                    {% endif %}
                </div>
                
                <button type="button" onclick="addColorRow()"
                        class="mt-4 text-primary hover:underline">
                    + Them tuy chon mau sac
                </button>
            </div>

            <!-- Nut submit -->
            <div class="flex justify-end gap-4">
                <a href="{% url 'admin_product_list' %}" 
                   class="px-6 py-3 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 transition">
                    Huy
                </a>
                <button type="submit" 
                        class="px-6 py-3 bg-primary text-white rounded-lg font-semibold hover:bg-blue-600 transition">
                    {% if is_edit %}Cap nhat san pham{% else %}Them san pham{% endif %}
                </button>
            </div>
        </form>
    </div>
</div>
{% endblock %}
